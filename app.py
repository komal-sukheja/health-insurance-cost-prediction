import gradio as gr
from predict import predict_charges

def format_prediction(age, sex, bmi, children, smoker, region):
    cost = predict_charges(age, sex, bmi, children, smoker, region)
    formatted = f"$ {cost:,}"
    return f"## üõ°Ô∏è {formatted}", formatted

with gr.Blocks(theme=gr.themes.Soft()) as app:

    gr.Markdown("# üè• Health Insurance Cost Prediction")
    gr.Markdown(
        "Estimate your **annual medical insurance cost** using a deep learning model built with PyTorch. The model uses **feature scaling, categorical encoding**, and a **neural network regression approach**."
    )

    gr.Markdown("### üîç This application predicts insurance charges based on:")
    gr.Markdown(
        """
        - Personal attributes (age, gender)
        - Health indicators (BMI)
        - Lifestyle habits (smoking)
        - Family & region information
        """
    )

    with gr.Row():

        # INPUT COLUMN
        with gr.Column(scale=2):
            gr.Markdown("### üßæ Enter Your Details")

            age = gr.Slider(18, 64, step=1, label="Age (Years)", value=25)
            sex = gr.Radio(["female", "male"], label="Gender", value="female")
            bmi = gr.Number(label="BMI (Body Mass Index)", value=22.5)
            children = gr.Slider(0, 6, step=1, label="Number of Children", value=1)
            smoker = gr.Radio(["no", "yes"], label="Smoking Status", value="no")
            region = gr.Dropdown(
                ["southwest", "southeast", "northwest", "northeast"],
                label="Residential Region", value="southwest"
            )

            submit = gr.Button("üîÆ Predict Insurance Cost", variant="secondary")

        # OUTPUT COLUMN
        with gr.Column(scale=1):
            gr.Markdown("### üìä Prediction Output")

            prediction_md = gr.Markdown("## ‚Äî")

            output = gr.Textbox(
                label="Estimated Annual Insurance Cost (USD)",
                interactive=False
            )

            gr.Markdown(
                """
                **Note:**  
                This value is an estimate generated by a trained deep learning model  
                and should be interpreted as an **approximation**, not an official quote.
                """
            )

    submit.click(
        format_prediction,
        inputs=[age, sex, bmi, children, smoker, region],
        outputs=[prediction_md, output]
    )

    gr.Markdown(
        "Built with **PyTorch** | Deployed with **Gradio**"
    )

app.launch()
